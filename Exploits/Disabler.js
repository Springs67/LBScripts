// this is basically useless, its annoying to find stuff

/// api_version=2

var plr = mc.thePlayer
function speed(v) { plr.motionX *= v; plr.motionZ *= v; }
function setMotionY(v) { plr.motionY = v }
function sendPacket(v) { plr.sendQueue.addToSendQueue(v) }
function setTimer(v) { mc.timer.timerSpeed = v }
function setYPos(v) { plr.setPosition(plr.posX, plr.posY + v, plr.posZ) }
var tick = 0
var tick2 = 0
var modulesEnabled = 0
var play_client = "net.minecraft.network.play.client"

var packets = [
    C0FPacketConfirmTransaction = Java.type(play_client + ".C0FPacketConfirmTransaction"),
    C04PacketPlayerPosition = Java.type(play_client + ".C03PacketPlayer.C04PacketPlayerPosition"),
    C18PacketSpectate = Java.type(play_client + ".C18PacketSpectate"),
    C03PacketPlayer = Java.type(play_client + ".C03PacketPlayer"),
    C02PacketUseEntity = Java.type(play_client + ".C02PacketUseEntity"),
    C00PacketKeepAlive = Java.type(play_client + ".C00PacketKeepAlive"),
    C13PacketPlayerAbilities = Java.type(play_client + ".C13PacketPlayerAbilities"),
    C09PacketHeldItemChange = Java.type(play_client + ".C09PacketHeldItemChange"),
    C17PacketCustomPayload = Java.type(play_client + ".C17PacketCustomPayload"),
]

var Disabler = registerScript({
    name: "Disabler",
    version: "1.0.0",
    authors: ["spring67"]
})

Disabler.registerModule({
    name: "Disabler2",
    category: "Fun",
    description: "craZzy",
    tag: "blehhh",
    settings: {
        Mode: Setting.list({
            name: "Mode",
            default: "None",
            values: [
                "None",
                // vulcan
                "VulcanStrafe",
            ]
        }),
        Ticks: Setting.float({
            name: "TicksCanceled",
            default: 5,
            min: 0,
            max: 20,
        }),

        // cancel packets
        C03Player: Setting.boolean({
            name: "cancel C03PacketPlayer",
            default: false,
        }),
        C04PlayerPos: Setting.boolean({
            name: "cancel C04PacketPlayerPosition",
            default: false,
        }),
        C0FConfirmTransaction: Setting.boolean({
            name: "cancel C0FPacketConfirmTransaction",
            default: false,
        }),
        C02UseEntity: Setting.boolean({
            name: "cancel C02PacketUseEntity",
            default: false,
        }),
        C00KeepAlive: Setting.boolean({
            name: "cancel C00PacketKeepAlive",
            default: false,
        }),
        C09HeldItemChange: Setting.boolean({
            name: "cancel C09PacketHeldItemChange",
            default: false,
        }),

        // send packets
        PlayerPositionEdit: Setting.boolean({
            name: "PlayerPositionEdit",
            default: false,
        }),
        PlayerPositionVoid: Setting.boolean({
            name: "PlayerPositionVoid",
            default: false,
        }),
        PlayerPosition3: Setting.boolean({
            name: "PlayerPosition3",
            default: false,
        }),
    }
}, function(module) {
    module.on("enable", function(){
        if (module.settings.C03Player.get()) {
            modulesEnabled++
        }
        if (module.settings.C04PlayerPos.get()) {
            modulesEnabled++
        }
        if (module.settings.C0FConfirmTransaction.get()) {
            modulesEnabled++
        }
        if (module.settings.C02UseEntity.get()) {
            modulesEnabled++
        }
        if (module.settings.C00KeepAlive.get()) {
            modulesEnabled++
        }
        if (module.settings.C09HeldItemChange.get()) {
            modulesEnabled++
        }

        if (module.settings.PlayerPositionEdit.get()) {
            modulesEnabled++
        }
        if (module.settings.PlayerPositionVoid.get()) {
            modulesEnabled++
        }
        if (module.settings.PlayerPosition3.get()) {
            modulesEnabled++
        }
        if (module.settings.Mode.get() == "VulcanStrafe") {
            modulesEnabled ++
        }
    })
    module.on("disable", function(){
        tick = 0
        modulesEnabled = 0
    })
    module.on("update", function(){
        tick ++

        if (module.settings.Mode.get() == "VulcanStrafe") {
            if (tick > 2) {
                if (!plr.onGround) {
                    sendPacket(new C04PacketPlayerPosition(plr.posX, plr.posY - .01, plr.posZ, true))
                }
                tick = 0
            }
        }

        if (module.settings.PlayerPositionEdit.get()) {
            if (tick > 20) {
                sendPacket(new C04PacketPlayerPosition(plr.posX, plr.posY + .1, plr.posZ, true))
                tick = 0
            }
        }
        if (module.settings.PlayerPositionVoid.get()) {
            if (tick > 20) {
                sendPacket(new C04PacketPlayerPosition(plr.posX, 100, plr.posZ, false))
                tick = 0
            }else{
                sendPacket(new C04PacketPlayerPosition(plr.posX, plr.posY + 0.001, plr.posZ, true))
            }
        }

        if (module.settings.PlayerPosition3.get()) {
            if (tick > 20) {
                sendPacket(new C04PacketPlayerPosition(plr.posX, plr.posY + 1, plr.posZ, true))
                tick = 0
            }else{
                sendPacket(new C04PacketPlayerPosition(plr.posX, plr.posY - 0.001, plr.posZ, true))
            }
        }

        module.tag = modulesEnabled
    })
    module.on("packet", function(eventPacket){
        var packet = eventPacket.getPacket()

        if (module.settings.C03Player.get()) {
            if (packet instanceof C03PacketPlayer) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("cancled C03")
                    tick = 0
                }
            }
        }

        if (module.settings.C04PlayerPos.get()) {
            if (packet instanceof C04PacketPlayerPosition) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("cancled C04")
                    tick = 0
                }
            }
        }

        if (module.settings.C0FConfirmTransaction.get()) {
            if (packet instanceof C0FPacketConfirmTransaction) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("canceled C0F")
                    tick = 0
                }
            }
        }

        if (module.settings.C02UseEntity.get()) {
            if (packet instanceof C02PacketUseEntity) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("sent C02")
                    tick = 0
                }
            }
        }

        if (module.settings.C00KeepAlive.get()) {
            if (packet instanceof C00PacketKeepAlive) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("canceled C00")
                    tick = 0
                }
            }
        }

        if (module.settings.C09HeldItemChange.get()) {
            if (packet instanceof C09PacketHeldItemChange) {
                if (tick > module.settings.Ticks.get()) {
                    eventPacket.cancelEvent()
                    Chat.print("canceled C09")
                    tick = 0
                }
            }
        }
    })
});
